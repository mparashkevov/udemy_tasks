---
title: "pyproject.toml + UV — Quick Reference"
description: "Concise reference for using the UV package manager with pyproject.toml"
---

# pyproject.toml + UV (uv) — Quick Reference

## Purpose

- **UV (uv)** is a lightweight Python package manager and CLI that edits, installs, and locks dependencies in `pyproject.toml`.
- Use UV to keep `pyproject.toml` as the single source of truth, manage optional dependency groups, and produce reproducible installations via lockfiles.

## Why UV?

- Single-source dependency management in `pyproject.toml`.
- Easy group management (dev/test/feature extras).
- Automatic lockfile generation for reproducible installs (CI + developers).
- Rapid CLI workflow: add/remove/lock/install packages from the terminal.

## Quick Concepts

- **[build-system]**: Lists build tools (setuptools, wheel).
- **[project]**: Package metadata and main dependencies (production/runtime).
- **[project.optional-dependencies]**: Extras (named groups) used for dev/test/optional features.
- **tool.* sections** (e.g., `tool.mypy`, `tool.pytest`): Tool configuration, not runtime deps.
- **Lockfile** (created by `uv lock`): Stable reproducible dependency snapshot.

## Repository-specific notes

This repository defines the following optional groups:

- `frontend`
- `dataloader`
- `llm-proxy`
- `test`
- `dev`

---

## Getting started (macOS)

1. Create and activate a virtual environment:

```bash
python3 -m venv .venv
source .venv/bin/activate
python -m pip install -U pip
```

2. Install UV:

```bash
pip install uv
```

3. Install dependencies from `pyproject.toml`:

```bash
uv install
```

---

## Core commands — UV (uv)

- Install the project:

```bash
uv install
```

- Add a package to production dependencies (core list):

```bash
uv add requests==2.31.0
```

- Add a package to a named group (dev/test/optional):

```bash
uv add --group dev ruff
uv add --group test pytest==7.4.0
title: "Documentation: Managing `pyproject.toml` with UV"

- Create a new optional group and add a package:
 
# Documentation: Managing `pyproject.toml` with UV

## 1. What is UV and why we use it
**UV** is a fast, modern Python package and environment manager that streamlines development, testing, and deployment.

- Lightning-fast package installation and dependency resolution.
- Reliable dependency locking and reproducible environments
- Compatible with existing Python tools and workflows
- Built-in virtual environment management
- Uses `pyproject.toml` as the single source of truth.

---

## 2. Structure of `pyproject.toml`
This file defines project metadata, dependencies, and tool configurations:

- **Build system:**  
  `[build-system]` uses `setuptools` and `wheel` with `setuptools.build_meta` as the backend.

- **Project metadata:**  
  `[project]` includes name, version, description, Python version, readme, and authors.

- **Production dependencies:**  
  `dependencies` lists core packages used in production (e.g., FastAPI, Uvicorn, LlamaIndex ecosystem, databases and cloud clients, utilities).

- **Optional dependency groups:**  
  `[project.optional-dependencies]` organizes installable groups:
  - **frontend:** UI/web app stack (Prisma, Jinja2, `python-jose[cryptography]`, Azure Data Lake).
  - **dataloader:** ingestion, storage, readers, workers (Redis KV/docstore, Neo4j vector store, GitHub reader, `rq`).
  - **llm-proxy:** LLM integrations (SAP AI SDK, OpenAI, Vertex AI, LangChain).
  - **test:** testing frameworks and utilities (pytest, coverage, asyncio tools, deepeval).
  - **dev:** developer tools (ruff, mypy, pre-commit).

- **Tooling configs:**  
  `[tool.setuptools.*]` for package discovery and data files; `[tool.mypy]` for type checking; `[tool.pytest.ini_options]` for test discovery.

**Note on versions:** We do not pin versions in `pyproject.toml`. Exact resolved versions are recorded in `uv.lock` to ensure reproducibility while keeping configuration flexible.

---

## 3. Dependency groups and installation
- **Production (default):** packages under `dependencies`.
- **Optional groups:** `frontend`, `dataloader`, `llm-proxy`, `test`, `dev` under `[project.optional-dependencies]`.

### Examples

---

## 4. Adding a new package (commands + manual)
### a) Using UV commands (recommended)
#### 1. Choose the target group:
Production: uv add <package>
Development: uv add --group dev <package>
Testing: uv add --group test <package>
Other optional groups: uv add --group <group> <package>
#### 2. Verify the package is placed in the correct section of pyproject.toml.
#### 3. Sync environment to resolve versions and update uv.lock:
uv sync
#### 4. Commit both pyproject.toml and uv.lock.

### b) Manual editing (supported)
#### 1. Open pyproject.toml
#### 2. Add the package under the appropriate section:
Production: append to the dependencies list.
Development: append under [project.optional-dependencies].dev.
Testing: append under [project.optional-dependencies].test.
Other groups: append under the respective key (e.g., frontend, dataloader, llm-proxy).
### 3. Save the file and sync:
uv sync
This resolves exact versions into uv.lock.
### 4. Commit both pyproject.toml and uv.lock.

---

## 5. Best practices
• Commit both files: Always commit pyproject.toml and uv.lock together.
• Do not edit uv.lock manually.
• Use groups to keep environments lean and purpose-specific.
• Run uv sync after any change (command or manual).

  "pytest",
  "pytest-asyncio",
]
analytics = [  # new optional feature group
  "pandas>=2.0",
]
```

After manual edits:

```bash
uv lock
uv install
```

---

## Best practices

- Keep production dependencies minimal and pinned.
- Put linting, formatting, and test tools in dev/test groups.
- Use optional groups for feature-specific dependencies and keep the base runtime lean.
- Always run `uv lock` and commit the lockfile after any change.
- Run tests and linters locally after adding/updating a package:

```bash
uv install
pytest
ruff .
mypy .
```

---

## CI Example (concise)

1. Checkout code
2. Create venv, install uv
3. Sync dependencies and run tests:

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install uv
uv install
pytest
```

---

## Troubleshooting & tips

- If a package fails to install via `uv install`, try adding it directly with `uv add` or pin its version.
- Remove a package and run `uv lock` to update the lockfile and `uv install` to sync your environment.
- For reproducible CI, always use the project lockfile (the lock file created by `uv lock`).

---

## Quick examples (real-world)

- Add a production package:

```bash
uv add "psycopg2-binary==2.9.7"
uv lock
uv install
```

- Add a dev tool:

```bash
uv add --group dev black
uv lock
uv install
```

- Add a package to an existing optional group:

```bash
uv add --group frontend jinja2
uv lock
uv install
```

- Add to a new optional group:

```bash
uv add --group analytics pandas
uv lock
uv install
```

---

## Summary

- Use `uv add` for fast CLI-driven dependency edits.
- Use `uv lock` to create a reproducible lockfile and `uv install` to sync.
- Keep your runtime minimal, use optional groups for features and dev/test tooling, and commit both `pyproject.toml` and the generated lockfile.
- For this repo: use the existing optional groups (`frontend`, `dataloader`, `llm-proxy`, `test`, `dev`) or add new extras when required.

> Note: This document is concise by design. Add more project-specific details (e.g., exact group names and recommended version policies) to formal project docs where appropriate.
